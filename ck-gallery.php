<?php  $gallerydir = "gallery"; // Directory/Name where original pictures are located (No trailng slash!)  $thumbsdir = "$gallerydir/thumbs"; // Directory/Name where thumbnails are to be stored (No trailng slash!)  $logfile = "gallery-log.txt"; // Directory/Name of log file (No trailng slash!)  // *** DO NOT EDIT ANYTHING BELOW HERE UNLESS YOU ARE A PHP NINJA ***      // START FUNCTIONS    // Function modified from http://www.findmotive.com/2006/08/29/create-square-image-thumbnails-with-php/  function createThumb($source,$dest) {    $thumb_size = 100;    $size = getimagesize($source);    $width = $size[0];    $height = $size[1];    if($width > $height) {      $x = ceil(($width - $height) / 2 );      $width = $height;    } elseif($height > $width) {      $y = ceil(($height - $width) / 2);      $height = $width;    }    $new_im = ImageCreatetruecolor($thumb_size,$thumb_size);    if(strpos($source,'.jpg') == true) {      $im = imagecreatefromjpeg($source);    }    elseif(strpos($source,'.gif') == true) {      $im = imagecreatefromgif($source);    }    elseif(strpos($source,'.png') == true) {      $im = imagecreatefrompng($source);    }    else {      echo("<!-- Not a valid format. -->");    }    imagecopyresampled($new_im,$im,0,0,$x,$y,$thumb_size,$thumb_size,$width,$height);    imagejpeg($new_im,$dest,80);  }    // END FUNCTIONS  // Create log file if it does not exist, otherwise open log for writing  if ( file_exists($logfile) == false ) {    $log = fopen($logfile, "a"); // Open log file for writing    fwrite($log,"*** LOG FILE CREATED ON ".date("Y-m-d")." AT ".date("H:i:s")." ***\n\n");  }  else {    $log = fopen($logfile, "a"); // Open log file for writing  }  // Create image directory if it doesn't exist  if ( file_exists($gallerydir) == false ) {    mkdir($gallerydir);    fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $gallerydir\n");  }  // Create thumbnail directory if it doesn't exist  if ( file_exists($thumbsdir) == false ) {    mkdir($thumbsdir);    fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir\n");  }  echo("<!-- Start CK-Gallery v .75 - Created by, Chris Kankiewicz [http://web-geek.net/ck-gallery] -->\n");  // Converts image file extensions to all lowercase  $currentdir = opendir($gallerydir);    while(false !== ($file = readdir($currentdir))) {      if(strpos($file,'.JPG',1) || strpos($file,'.GIF',1) || strpos($file,'.PNG',1)) {        $srcfile = "$gallerydir/$file"; // Define source        $filearray = explode(".",$file); // Create array from file        $count = count($filearray); // Identify array length        $pos = $count - 1; // Identify extension index        $filearray[$pos] = strtolower($filearray[$pos]); // Convert extension to lowercase        $file = implode(".",$filearray); // Create string from array        $dstfile = "$gallerydir/$file"; // Define destination        rename($srcfile,$dstfile);// Rename file        fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  RENAMED: $srcfile to $dstfile\n");      }    }  // Clean up thumbnail directory  $thumbdir = opendir ($thumbsdir);    while (false !== ($thumb = readdir($thumbdir))) {      if (file_exists("$gallerydir/$thumb") == false ) {        unlink("$thumbsdir/$thumb");        fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  REMOVED: $thumbsdir/$thumb\n");      }    }  // Create thumbnails if thumbail doesn't already exist  $filedir = opendir ($gallerydir);    while (false !== ($file = readdir($filedir))) {      if (strpos($file, '.jpg',1) && file_exists("$thumbsdir/$file") == false || strpos($file, '.gif',1) && file_exists("$thumbsdir/$file") == false || strpos($file, '.png',1) && file_exists("$thumbsdir/$file") == false) {        createThumb("$gallerydir/$file", "$thumbsdir/$file");        fwrite($log,date("Y-m-d")." @ ".date("H:i:s")."  CREATED: $thumbsdir/$file\n");      }    }  // Create photo gallery markup  echo("<div id=\"gallery-wrapper\">\n  <div id=\"ck-gallery\">\n");  $filedir = opendir ($gallerydir);  while (false !== ($file = readdir($filedir))) {    if (strpos($file, '.jpg',1) || strpos($file, '.gif',1) || strpos($file, '.png',1)) {      echo "    <div class=\"gallery-box\" style=\"float: left;\"><a href=\"$gallerydir/$file\" title=\"$file\" class=\"thickbox\" rel=\"photo-gallery\"><img src=\"$thumbsdir/$file\" alt=\"$file\" style=\"margin: 5px;\" /></a></div>\n";    }  }  echo("    <div class=\"clear\" style=\"clear: both;\"></div>\n");  echo("    <div id=\"credit\" style=\"float: right;\"><small>Powered by <a href=\"http://web-geek.net/ck-gallery\" onclick=\"window.open(this.href); return false;\" onkeypress=\"window.open(this.href); return false;\">CK-Gallery</a> &amp; <a href=\"http://jquery.com/demo/thickbox\" onclick=\"window.open(this.href); return false;\" onkeypress=\"window.open(this.href); return false;\">Thickbox</a></small></div>\n");  echo("    <div class=\"clear\" style=\"clear: both;\"></div>\n  </div>\n</div>\n");  echo("<!-- End CK-Gallery - Licensed under the GNU Public License version 3.0 -->");  fclose($log);?>