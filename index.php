<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>  <title>CK Gallery Demo</title>  <link href="gallery.css" rel="stylesheet" type="text/css" media="screen" />  <!-- THICKBOX -->  <script type="text/javascript" src="thickbox/jquery.js"></script>  <script type="text/javascript" src="thickbox/thickbox.js"></script>  <link rel="stylesheet" href="thickbox/thickbox.css" type="text/css" media="screen" />  <!-- /THICKBOX --></head><body><?php  // **************************************  // *  Title:   CK-Gallery.php           *  // *  Version: .71                      *  // *  Author:  Chris Kankiewicz         *  // *  Email:   chris@web-geek.net       *  // *  URL:     http://www.web-geek.net  *  // **************************************  $gallerydir = "gallery"; // Directory where original pictures are located  $thumbsdir = "$gallerydir/thumbs"; // Directory where thumbnails are to be stored  $logfile = "gallery-log.txt"; // Name of log file  // *** DO NOT EDIT ANYTHING BELOW HERE ***  // Delete log.txt if it exists  if ( file_exists($logfile) == true ) { unlink($logfile); }  $log = fopen($logfile, "a"); // Open log file for wriging  fwrite($log,"*** LOG FILE CREATED ON ".date("Y-m-d")." AT ".date("H:i:s")." ***\n\n");  // Create /gallery if it doesn't exist  if ( file_exists($gallerydir) == false ) {    mkdir($gallerydir);    fwrite($log,"CREATED: $gallerydir\n\n");  }  // Create thumbnail directory if it doesn't exist  if ( file_exists($thumbsdir) == false ) {    mkdir($thumbsdir);    fwrite($log,"CREATED: $thumbsdir\n\n");  }  echo("<!-- Start CK-Gallery - Created by, Chris Kankiewicz [http://www.web-geek.net] -->");  // Thumbnail function modified from http://www.findmotive.com/2006/08/29/create-square-image-thumbnails-with-php/  function createThumb($source,$dest) {    $thumb_size = 100;  	$size = getimagesize($source);  	$width = $size[0];  	$height = $size[1];  	if($width > $height) {  		$x = ceil(($width - $height) / 2 );  		$width = $height;  	} elseif($height > $width) {  		$y = ceil(($height - $width) / 2);  		$height = $width;  	}  	$new_im = ImageCreatetruecolor($thumb_size,$thumb_size);    if(strpos($source,'.jpg') == true) {      $im = imagecreatefromjpeg($source);    }    elseif(strpos($source,'.gif') == true) {      $im = imagecreatefromgif($source);    }    elseif(strpos($source,'.png') == true) {      $im = imagecreatefrompng($source);    }    else {      echo("Not a valid format.");    }  	imagecopyresampled($new_im,$im,0,0,$x,$y,$thumb_size,$thumb_size,$width,$height);  	imagejpeg($new_im,$dest,80);  }  function changeext($directory, $ext1, $ext2, $verbose = false) {    $num = 0;    if($curdir = opendir($directory)) {     while($file = readdir($curdir)) {       if($file != '.' && $file != '..') {         $srcfile = $directory . '/' . $file;         $string  = "$file";         $str     = strlen($ext1);         $str++;         $newfile = substr($string, 0, -$str);         $newfile = $newfile.'.'.$ext2;         $dstfile = $directory . '/' . $newfile;         if (eregi("\.$ext1",$file)) { # Look at only files with a pre-defined extension         $fileHand = fopen($srcfile, 'r');         fclose($fileHand);         rename($srcfile, $dstfile );         }         if(is_dir($srcfile)) {           $num += changeext($srcfile, $ext1, $ext2, $verbose);         }       }     }     closedir($curdir);    }    return $num;  }   // Rename *.JPG to *.jpg  $filedir = opendir ($gallerydir);    while (false !== ($file = readdir($filedir))) {      if (strpos($file, '.JPG',1)) {        changeext("$gallerydir",JPG,jpg,false);        fwrite($log,"RENAMED: $thumbsdir/$file\n");      }      elseif (strpos($file, '.GIF',1)) {        changeext("$gallerydir",GIF,gif,false);        fwrite($log,"RENAMED: $thumbsdir/$file\n");      }      elseif (strpos($file, '.PNG',1)) {        changeext("$gallerydir",PNG,png,false);        fwrite($log,"RENAMED: $thumbsdir/$file\n");      }    }  fwrite($log,"\n");  // Clean up thumbnail directory  $thumbdir = opendir ($thumbsdir);    while (false !== ($thumb = readdir($thumbdir))) {      if (file_exists("$gallerydir/$thumb") == false ) {        unlink("$thumbsdir/$thumb");        fwrite($log,"REMOVED: $thumbsdir/$thumb\n");      }    }  fwrite($log,"\n");  // Create new thumbnails  $filedir = opendir ($gallerydir);    while (false !== ($file = readdir($filedir))) {      if (strpos($file, '.jpg',1) && file_exists("$thumbsdir/$file") == false || strpos($file, '.gif',1) && file_exists("$thumbsdir/$file") == false || strpos($file, '.png',1) && file_exists("$thumbsdir/$file") == false) {  	  	createThumb("$gallerydir/$file", "$thumbsdir/$file");  	  	fwrite($log,"CREATED: $thumbsdir/$file\n");      }    }  // Create Photo Gallery Markup  echo("<div id=\"gallery-wrapper\">\n  <div id=\"ck-gallery\">\n");  $filedir = opendir ($gallerydir);  while (false !== ($file = readdir($filedir))) {    if (strpos($file, '.jpg',1) || strpos($file, '.gif',1) || strpos($file, '.png',1)) {	    echo "    <div class=\"gallery-box\" style=\"float: left;\"><a href=\"$gallerydir/$file\" title=\"$file\" class=\"thickbox\" rel=\"photo-gallery\"><img src=\"$thumbsdir/$file\" alt=\"$file\" style=\"margin: 5px;\" /></a></div>\n";	    //fwrite($log,"CREATED HTML: ./gallery/$file\n");    }  }  echo("    <div class=\"clear\"></div>\n");  echo("    <div id=\"credit\"><small>Powered by <a href=\"http://www.web-geek.net\" onclick=\"window.open(this.href); return false;\" onkeypress=\"window.open(this.href); return false;\">CK-Gallery</a> &amp; <a href=\"http://jquery.com/demo/thickbox\" onclick=\"window.open(this.href); return false;\" onkeypress=\"window.open(this.href); return false;\">Thickbox</a></small></div>\n");  echo("    <div class=\"clear\"></div>\n  </div>\n</div>\n");  echo("<!-- End CK-Gallery - Licensed under the Creative Commons Attribution-Share Alike 3.0 License-->");  fwrite($log,"\n*** END OF FILE ***");  fclose($log);?></body></html>